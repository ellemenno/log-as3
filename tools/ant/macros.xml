<?xml version="1.0" encoding="UTF-8"?>

<project name="ant.includes.macros" default="-usage" basedir=".">

<description>
Reusable macros
</description>
	
	<macrodef name="dynamic-property">
		<attribute name="name"/>
		<attribute name="value"/>
		<sequential>
			<property name="@{name}" value="@{value}"/>
		</sequential>
	</macrodef>
	
	<macrodef name="increment-build">
		<attribute name="file" default="build.number"/>
		<sequential>
			<propertyfile file="@{file}" comment="Auto-generated by Ant. Edit not.">
				<entry key="build.number" type="int" operation="+" default="0"/>
			</propertyfile>
		</sequential>
	</macrodef>
	
	<macrodef name="semver" description="sets project-based semver property for versioning (http://semver.org/)">
		<attribute name="major" default="0"/>
		<attribute name="minor" default="0"/>
		<attribute name="project" default="default"/>
		<attribute name="file" default="build.number"/>
		
		<sequential>
			<property file="@{file}"/>
			<dynamic-property name="semver.@{project}" value="@{major}.@{minor}.${build.number}"/>
			<echo message="semver.@{project} is set to '@{major}.@{minor}.${build.number}'"/>
		</sequential>
	</macrodef>
	
	<macrodef name="open" description="opens file with exe">
		<attribute name="exe" default=""/>
		<attribute name="file" default=""/>
		<sequential>
			<echo message="- - open macro - -"/>
			<echo message="opening '@{file}' with '@{exe}'"/>
			
			<exec osfamily="windows" spawn="true" executable="cmd">
				<arg line='/c start "" "@{exe}" @{file}'/>
			</exec>
			
			<exec osfamily="mac" spawn="true" executable="open">
				<arg line="-n -a @{exe} @{file}"/>
			</exec>
		</sequential>
	</macrodef>
	
	<macrodef name="mxmlc">
		<attribute name="file"/>
		<attribute name="options" default=""/>
		<attribute name="config"/>
		<attribute name="configop" default="+="/>
		<sequential>
			<echo message="- - mxmlc macro - -"/>
			<echo message="compiling '@{file}'"/>
			
			<java 
				jar="${flex.lib}/mxmlc.jar"
				dir="${flex.frameworks}"
				fork="true"
				failonerror="true"
				>
				<arg value="@{options} -load-config@{configop}@{config}"/>
				<arg value="@{file}"/>
			</java>
		</sequential>
	</macrodef>
	
	<macrodef name="compc">
		<attribute name="file"/>
		<attribute name="options" default=""/>
		<attribute name="config"/>
		<attribute name="configop" default="+="/>
		<sequential>
			<echo message="- - compc macro - -"/>
			<echo message="creating '@{file}'"/>
			
			<java 
				jar="${flex.lib}/compc.jar"
				dir="${flex.frameworks}"
				fork="true"
				failonerror="true"
				>
				<arg line="@{options} -load-config@{configop}@{config}"/>
				<arg value="-output=@{file}"/>
			</java>
		</sequential>
	</macrodef>

</project>
